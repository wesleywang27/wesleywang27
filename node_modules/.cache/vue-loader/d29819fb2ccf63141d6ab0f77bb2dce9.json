{"remainingRequest":"/Users/deyi/Projects/wesleywang27.github.io/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/deyi/Projects/wesleywang27.github.io/src/components/Editor.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/deyi/Projects/wesleywang27.github.io/src/components/Editor.vue","mtime":1636378855039},{"path":"/Users/deyi/Projects/wesleywang27.github.io/node_modules/babel-loader/lib/index.js","mtime":1636189010120},{"path":"/Users/deyi/Projects/wesleywang27.github.io/node_modules/cache-loader/dist/cjs.js","mtime":1636189010152},{"path":"/Users/deyi/Projects/wesleywang27.github.io/node_modules/vue-loader/lib/index.js","mtime":1636189011347}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Prism from 'prismjs'\nimport 'prismjs/themes/prism-okaidia.css'\nimport '../utils/raf'\nimport data from '../mock/data'\n\nimport Executions from './Executions'\nimport Invitation from './Invitation'\nimport Barrage from './Barrage'\n\nexport default {\n  name: 'Editor',\n  components: {Executions, Invitation, Barrage },\n  data() {\n    return {\n      startDate: '',\n      code: data.code,\n      currentCode: '',\n      isCursorVisible: 1,\n      canExecute: false,\n      canOpen: false,\n      wish: '',\n      hasClosed: false,\n      canStart: false\n    }\n  },\n  created() {\n    this.startDate = (new Date()).toDateString()\n    this.progressivelyTyping()\n  },\n  updated() {\n    this.scrollToBottom()\n  },\n  computed: {\n    highlightedCode () {\n      const code = Prism.highlight(\n          this.currentCode,\n          Prism.languages.javascript\n        )\n      const codeWithCursor = `${code}<span style=\"opacity:${this.isCursorVisible}\"> ▍</span>`\n      return codeWithCursor\n    }\n  },\n  mounted() {\n    // 播放音乐\n    let oAudio = document.querySelector(\"#keyboard\");\n    oAudio.onended = function() {\n      //播放完毕，重新循环播放\n      oAudio.stop();\n      // oAudio.load();\n      // oAudio.play();\n    };\n    this.audioAutoPlay()\n  },\n  methods: {\n    scrollToBottom() {\n      // 保持页面一直滚到最下面\n      this.$refs.editor.scrollTop = 100000\n    },\n    // 代码输入\n    progressivelyTyping() {\n      return new Promise((resolve) => {\n        let count = 0, typingCount = 0, typing\n        // 写代码每一帧的函数\n        let step = () => {\n          let randomNumber = Math.round(Math.random() * 6)\n          // 模拟打字的随机速度\n          if(count % 2 === 0 && randomNumber % 4 === 0){\n            this.currentCode = this.code.substring(0, typingCount)\n            typingCount++\n          }\n          // 大约每 24 帧光标闪动一次\n          if(count % 24 === 0){\n            this.isCursorVisible = this.isCursorVisible === 0 ? 1 : 0\n          }\n          count++\n          if (typingCount <= this.code.length) {\n            typing = requestAnimationFrame(step)\n          } else {\n            resolve()\n            this.canExecute = true\n            cancelAnimationFrame(typing)\n          }\n        }\n        typing = requestAnimationFrame(step)\n      })\n    },\n    // 发送弹幕之后\n    onAfterSending(wish) {\n      this.wish = wish\n      this.canOpen = true\n      setTimeout(() => {\n        this.canStart = true\n      }, 800)\n    },\n    // 播放音效\n    audioAutoPlay() {\n      let audio = document.getElementById('keyboard');\n      audio.play();\n      document.removeEventListener(\"touchstart\", this.audioAutoPlay);\n    }\n  }\n}\n",{"version":3,"sources":["Editor.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Editor.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"wedding-editor\" ref=\"editor\">\n    <header class=\"editor-header\">\n        <a href=\"javascript:;\"></a>\n        <a href=\"javascript:;\" class=\"minimum\"></a>\n        <a href=\"javascript:;\" class=\"maximum\"></a>\n        </header>\n    <!-- 日期 -->\n    <p class=\"code\">Today login: <span>{{ startDate }}</span> on happiness machine.</p>\n    <!-- 键盘音效 -->\n    <div >\n      <audio id=\"keyboard\" :src=\"require('../audios/keyboard.mp3')\"></audio>\n    </div>\n    <!--代码编辑区-->\n    <pre>\n      <code v-html=\"highlightedCode\"></code>\n    </pre>\n    <!-- 打开邀请函 -->\n    <div\n      class=\"editor-open\"\n      v-if=\"(canStart || hasClosed) && !canOpen\"\n      @click=\"canOpen = true\"\n    >\n      <svg viewBox=\"0 0 24 24\" width=\"18\" height=\"18\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"css-i6dzq1\">\n        <rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"2\" ry=\"2\"></rect>\n        <line x1=\"9\" y1=\"3\" x2=\"9\" y2=\"21\"></line>\n      </svg>\n    </div>\n    <Executions :canExecute=\"canExecute\" @onUpdating=\"scrollToBottom\" @onFinish=\"canOpen = true\"/>\n    <invitation :canOpen=\"canOpen\" @onClose=\"canOpen = false, hasClosed = true, canStart = false\" @sendBarrage=\"onAfterSending\"/>\n    <Barrage :wish=\"wish\" :canStart=\"canStart\"/>\n  </div>\n</template>\n\n<script>\n  import Prism from 'prismjs'\n  import 'prismjs/themes/prism-okaidia.css'\n  import '../utils/raf'\n  import data from '../mock/data'\n\n  import Executions from './Executions'\n  import Invitation from './Invitation'\n  import Barrage from './Barrage'\n\n  export default {\n    name: 'Editor',\n    components: {Executions, Invitation, Barrage },\n    data() {\n      return {\n        startDate: '',\n        code: data.code,\n        currentCode: '',\n        isCursorVisible: 1,\n        canExecute: false,\n        canOpen: false,\n        wish: '',\n        hasClosed: false,\n        canStart: false\n      }\n    },\n    created() {\n      this.startDate = (new Date()).toDateString()\n      this.progressivelyTyping()\n    },\n    updated() {\n      this.scrollToBottom()\n    },\n    computed: {\n      highlightedCode () {\n        const code = Prism.highlight(\n            this.currentCode,\n            Prism.languages.javascript\n          )\n        const codeWithCursor = `${code}<span style=\"opacity:${this.isCursorVisible}\"> ▍</span>`\n        return codeWithCursor\n      }\n    },\n    mounted() {\n      // 播放音乐\n      let oAudio = document.querySelector(\"#keyboard\");\n      oAudio.onended = function() {\n        //播放完毕，重新循环播放\n        oAudio.stop();\n        // oAudio.load();\n        // oAudio.play();\n      };\n      this.audioAutoPlay()\n    },\n    methods: {\n      scrollToBottom() {\n        // 保持页面一直滚到最下面\n        this.$refs.editor.scrollTop = 100000\n      },\n      // 代码输入\n      progressivelyTyping() {\n        return new Promise((resolve) => {\n          let count = 0, typingCount = 0, typing\n          // 写代码每一帧的函数\n          let step = () => {\n            let randomNumber = Math.round(Math.random() * 6)\n            // 模拟打字的随机速度\n            if(count % 2 === 0 && randomNumber % 4 === 0){\n              this.currentCode = this.code.substring(0, typingCount)\n              typingCount++\n            }\n            // 大约每 24 帧光标闪动一次\n            if(count % 24 === 0){\n              this.isCursorVisible = this.isCursorVisible === 0 ? 1 : 0\n            }\n            count++\n            if (typingCount <= this.code.length) {\n              typing = requestAnimationFrame(step)\n            } else {\n              resolve()\n              this.canExecute = true\n              cancelAnimationFrame(typing)\n            }\n          }\n          typing = requestAnimationFrame(step)\n        })\n      },\n      // 发送弹幕之后\n      onAfterSending(wish) {\n        this.wish = wish\n        this.canOpen = true\n        setTimeout(() => {\n          this.canStart = true\n        }, 800)\n      },\n      // 播放音效\n      audioAutoPlay() {\n        let audio = document.getElementById('keyboard');\n        audio.play();\n        document.removeEventListener(\"touchstart\", this.audioAutoPlay);\n      }\n    }\n  }\n</script>\n\n<style lang=\"less\">\n.wedding-editor{\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  padding: 15px;\n  padding-top: 50px;\n  overflow-x: hidden;\n  overflow-y: auto;\n  z-index: 1;\n  transform-origin: 0 0;\n  -webkit-transform-origin: 0 0;\n  transition: all 1.6s cubic-bezier(0.4, 0, 1, 1);\n  -webkit-transition: all 1.6s cubic-bezier(0.4, 0, 1, 1);\n  .editor-header{\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    padding: 12px;\n    overflow: hidden;\n    background: #2B2B48;\n    z-index: 3;\n    >a{\n      float: left;\n      display: block;\n      width: 16px;\n      height: 16px;\n      margin-right: 5px;\n      border-radius: 8px;\n      background: #FC615D;\n      &.minimum{\n        background: #FDBC40;\n      }\n      &.maximum{\n        background: #34C84A;\n      }\n    }\n  }\n  p.code{\n    margin: 0;\n    color: #BBB;\n    line-height: 1.2;\n    font-family: 'Roboto Mono', 'Menlo', 'Monaco', Courier, monospace !important;\n    font-weight: 500 !important;\n    font-size: 16px!important;\n  }\n  pre{\n    margin: 0;\n    white-space: pre-wrap;\n    code{\n      white-space: pre-wrap;\n      word-break: break-all;\n      font-size: 16px!important;\n      margin: 0;\n      color: #BBB;\n      line-height: 1.2;\n      font-family: 'Roboto Mono', 'Menlo', 'Monaco', Courier, monospace !important;\n      font-weight: 500 !important;\n      background: transparent;\n    }\n  }\n  .editor-open{\n    position: fixed;\n    right: 20px;\n    bottom: 20px;\n    width: 40px;\n    height: 40px;\n    padding: 6px;\n    border-radius: 20px;\n    text-align: center;\n    line-height: 18px;\n    border: 5px solid #ffd69b;\n    color: #a9895d;\n    background: #FFF1DE;\n    z-index: 1000;\n  }\n}\n</style>"]}]}